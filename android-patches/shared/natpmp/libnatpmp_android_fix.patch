--- a/vendor/nim-codex/vendor/nim-nat-traversal/vendor/libnatpmp-upstream/Makefile
+++ b/vendor/nim-codex/vendor/nim-nat-traversal/vendor/libnatpmp-upstream/Makefile
@@ -5,7 +5,10 @@
 # http://miniupnp.free.fr/libnatpmp.html
 
 OS = $(shell $(CC) -dumpmachine)
-CC ?= gcc
+CC ?= $(shell if [ "$(ANDROID_NDK_HOME)" != "" ] && [ "$(TARGET_ARCH)" = "arm64" ]; then echo "$(ANDROID_NDK_HOME)/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android21-clang"; else echo "gcc"; fi)
+ifeq ($(TARGET_ARCH),arm64)
+TARGET_ARCH :=
+endif
 ARCH = $(OS)
 VERSION = $(shell cat VERSION)
 INSTALL ?= $(shell which install)
@@ -29,6 +32,11 @@ CFLAGS ?= -Os
 #CFLAGS = -g -O0
 CFLAGS += -fPIC
 CFLAGS += -Wall
 CFLAGS += -Wextra
 CFLAGS += -DENABLE_STRNATPMPERR
+ifeq ($(TARGET_ARCH),arm64)
+CFLAGS += -DANDROID
+CFLAGS += -fPIC
+TARGET_ARCH :=
+endif
 
 LIBOBJS = natpmp.o getgateway.o
