--- a/vendor/nim-codex/build.nims
+++ b/vendor/nim-codex/build.nims
@@ -28,6 +28,41 @@ proc buildBinary(name: string, srcDir = "./", params = "", lang = "c") =
 proc buildLibrary(name: string, srcDir = "./", params = "", `type` = "dynamic") =
   if not dirExists "build":
     mkDir "build"
+  
+  var extra_params = params
+
+  # Android-specific compiler flags
+  when defined(android):
+    let android_cc = getEnv("CODEX_ANDROID_CC", "aarch64-linux-android21-clang")
+    let android_ndk = getEnv("ANDROID_NDK_HOME")
+    let android_linker = android_ndk & "/toolchains/llvm/prebuilt/linux-x86_64/bin/ld.lld"
+    let android_omp_lib = android_ndk & "/toolchains/llvm/prebuilt/linux-x86_64/lib/clang/17/lib/linux/aarch64"
+    let android_sysroot = android_ndk & "/toolchains/llvm/prebuilt/linux-x86_64/sysroot"
+    let android_lib_path = android_sysroot & "/usr/lib/aarch64-linux-android"
+    let android_lib_path21 = android_lib_path & "/21"
+    let android_lib_path31 = android_lib_path & "/31"
+    let android_clang_lib = android_ndk & "/toolchains/llvm/prebuilt/linux-x86_64/lib/clang/17/lib/linux"
+    let android_builtins = android_clang_lib & "/libclang_rt.builtins-aarch64-android.a"
+    let android_crtbegin = android_lib_path21 & "/crtbegin_so.o"
+    let android_crtend = android_lib_path21 & "/crtend_so.o"
+    
+    extra_params &= " --cpu:arm64 --os:android --cc:clang --clang.execlang=" & android_cc
+    extra_params &= " --passl:-fuse-ld=" & android_linker
+    extra_params &= " --passl:-L" & android_omp_lib
+    extra_params &= " --passl:-L" & android_clang_lib
+    extra_params &= " --passl:-L" & android_lib_path
+    extra_params &= " --passl:-L" & android_lib_path21
+    extra_params &= " --passl:-L" & android_lib_path31
+    extra_params &= " --passl:-nostdlib"
+    extra_params &= " --passl:" & android_crtbegin
+    extra_params &= " --passl:" & android_crtend
+    extra_params &= " --passl:" & android_builtins
+    extra_params &= " --passl:-lc"
+    extra_params &= " --passl:-lm"
+    extra_params &= " --passl:-ldl"
+    extra_params &= " --passl:-Wl,--allow-multiple-definition"
+    extra_params &= " --passl:-Wl,--undefined-version"
+    extra_params &= " --passl:--target=aarch64-linux-android21"
 
   if `type` == "dynamic":
     let lib_name = (
@@ -35,19 +70,35 @@ proc buildLibrary(name: string, srcDir = "./", params = "", `type` = "dynamic")
       elif defined(macosx): name & ".dylib"
       else: name & ".so"
     )
+    # Set Leopard CMake flags based on environment variables
+    var leopard_cmake_flags = "-DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_BUILD_TYPE=Release"
+    when defined(android):
+      if existsEnv("ANDROID_ARM64_BUILD"):
+        leopard_cmake_flags &= " -DANDROID_ARM64_BUILD=1"
+      if existsEnv("NO_X86_INTRINSICS"):
+        leopard_cmake_flags &= " -DNO_X86_INTRINSICS=1"
+    
     exec "nim c" & " --out:build/" & lib_name &
       " --threads:on --app:lib --opt:size --noMain --mm:refc --header --d:metrics " &
       "--nimMainPrefix:libcodex -d:noSignalHandler " &
       "-d:LeopardExtraCompilerFlags=-fPIC " & "-d:chronicles_runtime_filtering " &
-      "-d:chronicles_log_level=TRACE " & params & " " & srcDir & name & ".nim"
+      "-d:chronicles_log_level=TRACE -d:LeopardCmakeFlags=\"" & leopard_cmake_flags & "\" " & extra_params & " " & srcDir & name & ".nim"
   else:
+    # Set Leopard CMake flags based on environment variables
+    var leopard_cmake_flags = "-DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_BUILD_TYPE=Release"
+    when defined(android):
+      if existsEnv("ANDROID_ARM64_BUILD"):
+        leopard_cmake_flags &= " -DANDROID_ARM64_BUILD=1"
+      if existsEnv("NO_X86_INTRINSICS"):
+        leopard_cmake_flags &= " -DNO_X86_INTRINSICS=1"
+    
     exec "nim c" & " --out:build/" & name &
       ".a --threads:on --app:staticlib --opt:size --noMain --mm:refc --header --d:metrics " &
       "--nimMainPrefix:libcodex -d:noSignalHandler " &
       "-d:LeopardExtraCompilerFlags=-fPIC " &
       "-d:chronicles_runtime_filtering " &
-      "-d:chronicles_log_level=TRACE " &
-      params & " " & srcDir & name & ".nim"
+      "-d:chronicles_log_level=TRACE -d:LeopardCmakeFlags=\"" & leopard_cmake_flags & "\" " &
+      extra_params & " " & srcDir & name & ".nim"
 
 proc test(name: string, srcDir = "tests/", params = "", lang = "c") =
   buildBinary name, srcDir, params
@@ -153,6 +204,11 @@ task libcodexDynamic, "Generate bindings":
       if param.len > 0 and param.startsWith("-"):
         params.add " " & param
 
+  # Android-specific parameters
+  when defined(android):
+    if existsEnv("CODEX_ANDROID_DEFINES"):
+      params.add " " & getEnv("CODEX_ANDROID_DEFINES")
+
   let name = "libcodex"
   buildLibrary name, "library/", params, "dynamic"
 
@@ -163,5 +219,10 @@ task libcodexStatic, "Generate bindings":
       if param.len > 0 and param.startsWith("-"):
         params.add " " & param
 
+  # Android-specific parameters
+  when defined(android):
+    if existsEnv("CODEX_ANDROID_DEFINES"):
+      params.add " " & getEnv("CODEX_ANDROID_DEFINES")
+
   let name = "libcodex"
-  buildLibrary name, "library/", params, "static"
+  buildLibrary name, "library/", params, "static"
\ No newline at end of file
